<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introducing the 'trickypdf'-package • trickypdf</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introducing the 'trickypdf'-package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trickypdf</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette.html">Introducing the 'trickypdf'-package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introducing the ‘trickypdf’-package</h1>
                        <h4 class="author">Andreas Blätte (<a href="mailto:andreas.blaette@uni-due.de" class="email">andreas.blaette@uni-due.de</a>)</h4>
            
            <h4 class="date">2019-11-19</h4>
      
      
      <div class="hidden name"><code>vignette.Rmd</code></div>

    </div>

    
    
<div id="aim-easing-the-pain-pdf-can-cause" class="section level1">
<h1 class="hasAnchor">
<a href="#aim-easing-the-pain-pdf-can-cause" class="anchor"></a>Aim: Easing the pain pdf can cause</h1>
<p>Many documents are available in a pdf format. There are many reasons why data scientists would want to convert pdf into XML as a semi-structured data format. Liberating text from the pdf prison is the first step to further process text in a Natural Language Processing (NLP) pipeline, or to analyse it directly. To support this rather technical step, R users can use a couple of packages to extract text from pdf documents, in particular <a href="">Rpoppler</a>, or <a href="">pdftools</a>. However, if you deal with somewhat or more heavily layouted document, the real work starts after text extraction. To get rid of unwanted features resulting from document layout, manual cleaning, batteries of regular expressions and several further programming quirks may be necessary to get the postprocessing task done.</p>
<p>The idea of the trickypdf package is to proactively deal with the layout of a document and to extract the text as cleanly as possible, to obviate the need for nerve-wrecking postprocessing.</p>
<div id="some-sample-scenarios" class="section level2">
<h2 class="hasAnchor">
<a href="#some-sample-scenarios" class="anchor"></a>Some sample scenarios</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(trickypdf)</a></code></pre></div>
<div id="scenario-a-two-column-pdf-a-table-of-contents-to-skip" class="section level3">
<h3 class="hasAnchor">
<a href="#scenario-a-two-column-pdf-a-table-of-contents-to-skip" class="anchor"></a>Scenario: A two column pdf, a table of contents to skip</h3>
<p>A typical scenario is that you have a pdf document with a two-column layout, with a front matter and/or a table of contents at the beginning of the document that you do not want to be part of the document that you process. As an example for this typical scenario, the package includes a protocol of the German Bundestag, the protocol of the 238th session of the 18th Bundestag.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">plenaryprotocol &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="dt">package =</span> <span class="st">"trickypdf"</span>, <span class="st">"extdata"</span>, <span class="st">"pdf"</span>, <span class="st">"18238.pdf"</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span>()) <span class="kw"><a href="https://rdrr.io/r/utils/browseURL.html">browseURL</a></span>(plenaryprotocol)</a></code></pre></div>
<p>For the pages with the debates and speeches, we will define boxes from which the text shall be extracted. Yet the first step is to identify the the page with the beginning of the actual debate. Looking at the pdf, there is one defining feature of this feature of the page: “Beginn: 9.00 Uhr”. And: “(Schluss: 15.10 Uhr)”.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">P &lt;-<span class="st"> </span>PDF<span class="op">$</span><span class="kw">new</span>(<span class="dt">filename_pdf =</span> plenaryprotocol)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3">P<span class="op">$</span><span class="kw">get_text_from_pages</span>(<span class="dt">paragraphs =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5">regexStartDebate &lt;-<span class="st"> "^</span><span class="ch">\\</span><span class="st">s*Beginn:</span><span class="ch">\\</span><span class="st">s+</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">.|:)</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">s+Uhr</span><span class="ch">\\</span><span class="st">s*$"</span></a>
<a class="sourceLine" id="cb3-6" title="6">regexEndDebate &lt;-<span class="st"> "^</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">(Schluss:</span><span class="ch">\\</span><span class="st">s+</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">s*(</span><span class="ch">\\</span><span class="st">.|:)</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">s+Uhr</span><span class="ch">\\</span><span class="st">)</span><span class="ch">\\</span><span class="st">s*$"</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">pageStartDebate &lt;-<span class="st"> </span>P<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/utils/apropos.html">find</a></span>(<span class="dt">regex =</span> regexStartDebate)</a>
<a class="sourceLine" id="cb3-9" title="9">pageEndDebate &lt;-<span class="st"> </span>P<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/utils/apropos.html">find</a></span>(<span class="dt">regex =</span> regexEndDebate)</a></code></pre></div>
<p>Having identified where the body of the debate starts, and where it ends, we re-instantiate the PDF class, but with the identified start and end pages.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">P<span class="op">$</span><span class="kw">drop_page</span>(<span class="dt">page =</span> (pageEndDebate <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>P<span class="op">$</span>no_pages)</a>
<a class="sourceLine" id="cb4-2" title="2">P<span class="op">$</span><span class="kw">drop_page</span>(<span class="dt">page =</span> <span class="dv">1</span><span class="op">:</span>(pageStartDebate <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a></code></pre></div>
<div id="procedure-1-get-text-from-defined-boxes" class="section level4">
<h4 class="hasAnchor">
<a href="#procedure-1-get-text-from-defined-boxes" class="anchor"></a>Procedure 1: Get text from defined boxes</h4>
<p>We can use Apple’s Preview tool or <code>tabulizer::???</code> to identify the coordinates of the boxes with left and right columns (see Annex). When we set page to NULL (the default), we make the definition for all pages.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">left =</span> <span class="dv">60</span>, <span class="dt">width =</span> <span class="dv">235</span>, <span class="dt">top =</span> <span class="dv">70</span>, <span class="dt">height =</span> <span class="dv">703</span>), <span class="dt">page =</span> <span class="ot">NULL</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">left =</span> <span class="dv">301</span>, <span class="dt">width =</span> <span class="dv">235</span>, <span class="dt">top =</span> <span class="dv">70</span>, <span class="dt">height =</span> <span class="dv">703</span>), <span class="dt">page =</span> <span class="ot">NULL</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>To inspect the result, see <code>P$boxes</code>. You will see that the coordinates in the resulting data.frame are not the input values: Recalibrating coordinates to the pixel format is automatically performed.</p>
<p>The layout of the first page is different, there is a header with relevant metadata, but we do not want it to be part of the text of the debate we extract. So we use the <code>$add_box()</code>-method again, but we explicitly state the page number. [it is one, not 5 - explain!]</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">left =</span> <span class="dv">58</span>, <span class="dt">width =</span> <span class="dv">235</span>, <span class="dt">top =</span> <span class="dv">277</span>, <span class="dt">height =</span> <span class="dv">493</span>), <span class="dt">page =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-2" title="2">P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">left =</span> <span class="dv">301</span>, <span class="dt">width =</span> <span class="dv">235</span>, <span class="dt">top =</span> <span class="dv">277</span>, <span class="dt">height =</span> <span class="dv">493</span>), <span class="dt">page =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>The PDF class is now appropriately configured. We instruct the PDF class to iterate through all boxes that have been defined and to get the text within these boxes.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">P<span class="op">$</span><span class="kw">get_text_from_boxes</span>(<span class="dt">paragraphs =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The result is stored as a list in the field . In this case, each element in the list is itself a list with the content of a box. You can see this, for instance, by typing <code>P$pages[[1]]</code>.</p>
<p>The justification of the text in the columns will lead to several surplus whitespaces. We remove it using the method <code>$purge()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">P<span class="op">$</span><span class="kw">purge</span>()</a></code></pre></div>
<p>To inspect the result, we re-xmlify the text, which will create a very simply xml in the field . We can turn this into a simple html document.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">P<span class="op">$</span><span class="kw">xmlify</span>()</a>
<a class="sourceLine" id="cb9-2" title="2">P<span class="op">$</span><span class="kw">xml2html</span>()</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span>()) P<span class="op">$</span><span class="kw">browse</span>()</a></code></pre></div>
<p>Assuming that we want a plain text document as output, we turn the list in the field <code>$pages</code> into a plain character vector that can be saved to disk.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">txt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(P<span class="op">$</span>pages))</a>
<a class="sourceLine" id="cb10-2" title="2">destfile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(<span class="dt">text =</span> txt, <span class="dt">con =</span> destfile)</a></code></pre></div>
</div>
<div id="approach-2" class="section level4">
<h4 class="hasAnchor">
<a href="#approach-2" class="anchor"></a>Approach 2</h4>
<p>The second approach for handling a two column layout with unwanted content on the margins will involve two steps. First, we define boxes with wanted content. Second, we remove anything that is external to these boxes. Third, we do away with the two column layout.</p>
<p>However, somewhat different from the first approach, the boxes just define an area with wanted content. They do not need to capture the layout in a lot of detail. So you just define one box per page.</p>
<p><img src="assets/one_box_per_page_1.png" width="500px"></p>
<p>To learn how to get the coordinates of the box, see the Annex. If we leave the parameter page of the <code>$add_box</code>-method undefined, the definition of a box will be applied to all pages.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">left =</span> <span class="dv">60</span>, <span class="dt">width =</span> <span class="dv">475</span>, <span class="dt">top =</span> <span class="dv">72</span>, <span class="dt">height =</span> <span class="dv">702</span>), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>However, the layout of the first page is somewhat different. Some metadata are given first.</p>
<p><img src="assets/one_box_per_page_2.png" width="500px"></p>
<p>So we define a different box for the first page we process.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">left =</span> <span class="dv">58</span>, <span class="dt">width =</span> <span class="dv">476</span>, <span class="dt">top =</span> <span class="dv">273</span>, <span class="dt">height =</span> <span class="dv">496</span>), <span class="dt">page =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The next step now is to remove everything from the pages – the xml of the pdf document – that is not within one of the boxes that we have defined.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">P<span class="op">$</span><span class="kw">remove_unboxed_text_from_all_pages</span>()</a></code></pre></div>
<p>Marginalia, column titles and page numbers have now been removed. So it is not necessary to remove these things in a postprocessing step.</p>
<p>We will dissolve the two column layout using the <code>$decolumnize()</code>-method: It rearranges the text on the pages by identifying what is to the right side of the middle of the page and moves it to the bottom of the page. To cope with crooked scans, the (integer) value in the field <code>$deviation</code> can be set, to allow for (small) deviations from the center line.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">P<span class="op">$</span>deviation &lt;-<span class="st"> </span>10L</a>
<a class="sourceLine" id="cb14-2" title="2">P<span class="op">$</span><span class="kw">decolumnize</span>()</a></code></pre></div>
<p>Let us get the result from the pages.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">P<span class="op">$</span><span class="kw">get_text_from_pages</span>(<span class="dt">paragraphs =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>A small post-processing step: We remove unwanted whitespace.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">P<span class="op">$</span><span class="kw">purge</span>() <span class="co"># cleaning</span></a></code></pre></div>
<p>The result is in the slot <code>$pages</code> of the class. We can re-create a simple XML using the <code>$xmlify</code> method (the result will be in the field <code>$xmlification</code>). This XMLification can be inspected as HTML.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">P<span class="op">$</span><span class="kw">xmlify</span>()</a>
<a class="sourceLine" id="cb17-2" title="2">P<span class="op">$</span><span class="kw">xml2html</span>()</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span>()) P<span class="op">$</span><span class="kw">browse</span>()</a></code></pre></div>
<p>To save plain text to disc, the same logic of unlisting the content in the field <code>$page</code> as before applies.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(</a>
<a class="sourceLine" id="cb18-2" title="2">  <span class="dt">text =</span> <span class="kw"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(P<span class="op">$</span>pages)),</a>
<a class="sourceLine" id="cb18-3" title="3">  <span class="dt">con =</span> destfile2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()</a>
<a class="sourceLine" id="cb18-4" title="4">  )</a></code></pre></div>
</div>
</div>
<div id="add-previously-undetected-headlines" class="section level3">
<h3 class="hasAnchor">
<a href="#add-previously-undetected-headlines" class="anchor"></a>Add previously undetected headlines</h3>
<p>In some two column documents, there are headlines which span over both columns. Sometimes, one cannot define the location of these headlines in advance. For this purpose, a functionality was created to detect these lines and add boxes accordingly. The process is just as described above with one added line. We use a plenary protocol from Saxony to illustrate the method.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">plenaryprotocol_saxony &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="dt">package =</span> <span class="st">"trickypdf"</span>, <span class="st">"extdata"</span>, <span class="st">"pdf"</span>, <span class="st">"SN_05_002.pdf"</span>)</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/interactive.html">interactive</a></span>()) <span class="kw"><a href="https://rdrr.io/r/utils/browseURL.html">browseURL</a></span>(plenaryprotocol_saxony)</a></code></pre></div>
<p>If you look at the pdf document, you see three headlines which are distributed irregularly.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">regexStartDebate &lt;-<span class="st"> "^</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">(Beginn</span><span class="ch">\\</span><span class="st">sder</span><span class="ch">\\</span><span class="st">sSitzung:?</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d{1,2}(:|</span><span class="ch">\\</span><span class="st">.)</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">sUhr</span><span class="ch">\\</span><span class="st">)</span><span class="ch">\\</span><span class="st">s*$"</span> </a>
<a class="sourceLine" id="cb20-2" title="2">regexEndDebate &lt;-<span class="st"> "^</span><span class="ch">\\</span><span class="st">s*</span><span class="ch">\\</span><span class="st">((Schluss|Ende|Schluß)</span><span class="ch">\\</span><span class="st">sder</span><span class="ch">\\</span><span class="st">sSitzung:?</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d{1,2}(:|</span><span class="ch">\\</span><span class="st">.)</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">sUhr</span><span class="ch">\\</span><span class="st">)</span><span class="ch">\\</span><span class="st">s*$"</span> </a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4">    P &lt;-<span class="st"> </span>PDF<span class="op">$</span><span class="kw">new</span>(<span class="dt">filename_pdf =</span> plenaryprotocol_saxony) </a>
<a class="sourceLine" id="cb20-5" title="5">    P<span class="op">$</span>jitter &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb20-6" title="6">    P<span class="op">$</span><span class="kw">get_text_from_pages</span>(<span class="dt">paragraphs =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb20-7" title="7"></a>
<a class="sourceLine" id="cb20-8" title="8">      pageStartDebate &lt;-<span class="st"> </span>P<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/utils/apropos.html">find</a></span>(<span class="dt">regex =</span> regexStartDebate)</a>
<a class="sourceLine" id="cb20-9" title="9">      pageEndDebate &lt;-<span class="st"> </span>P<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/utils/apropos.html">find</a></span>(<span class="dt">regex =</span> regexEndDebate)</a>
<a class="sourceLine" id="cb20-10" title="10"></a>
<a class="sourceLine" id="cb20-11" title="11">      P<span class="op">$</span><span class="kw">drop_page</span>(<span class="dt">page =</span> (pageEndDebate <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span>P<span class="op">$</span>no_pages) </a>
<a class="sourceLine" id="cb20-12" title="12">      P<span class="op">$</span><span class="kw">drop_page</span>(<span class="dt">page =</span> <span class="dv">1</span><span class="op">:</span>(pageStartDebate <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb20-13" title="13"></a>
<a class="sourceLine" id="cb20-14" title="14"></a>
<a class="sourceLine" id="cb20-15" title="15"></a>
<a class="sourceLine" id="cb20-16" title="16"></a>
<a class="sourceLine" id="cb20-17" title="17">  P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">top =</span> <span class="dv">68</span>, <span class="dt">height =</span> <span class="dv">710</span>, <span class="dt">left =</span> <span class="dv">54</span>, <span class="dt">width =</span> <span class="dv">240</span>), <span class="dt">page =</span> <span class="ot">NULL</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb20-18" title="18">  P<span class="op">$</span><span class="kw">add_box</span>(<span class="dt">box =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">top =</span> <span class="dv">68</span>, <span class="dt">height =</span> <span class="dv">710</span>, <span class="dt">left =</span> <span class="dv">300</span>, <span class="dt">width =</span> <span class="dv">240</span>), <span class="dt">page =</span> <span class="ot">NULL</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>After we declared these boxes, we add our headlines.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb21-2" title="2">P<span class="op">$</span><span class="kw">add_headline_boxes</span>()</a></code></pre></div>
<pre><code>## ...detecting headline boxes</code></pre>
<p>This process loops through every line of text and checks for lines which cross the middle of the page. It then concatenates these lines and recalculates the previously assigned boxes. With this step performed, we proceed like earlier.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">    P<span class="op">$</span><span class="kw">get_text_from_boxes</span>(<span class="dt">paragraphs =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb23-2" title="2">    P<span class="op">$</span><span class="kw">purge</span>()</a>
<a class="sourceLine" id="cb23-3" title="3">    plaintext &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unname.html">unname</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(P<span class="op">$</span>pages))</a></code></pre></div>
<p>As we see, the headlines are detected nicely.</p>
</div>
<div id="annex" class="section level3">
<h3 class="hasAnchor">
<a href="#annex" class="anchor"></a>Annex</h3>
<p><img src="assets/using_preview_1.png" width="500px"></p>
<p><img src="assets/using_preview_2.png" width="500px"></p>
<p><img src="assets/using_preview_3.png" width="500px"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#aim-easing-the-pain-pdf-can-cause">Aim: Easing the pain pdf can cause</a><ul class="nav nav-pills nav-stacked">
<li><a href="#some-sample-scenarios">Some sample scenarios</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andreas Blaette, Christoph Leonhardt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
